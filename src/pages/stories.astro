---
const res = await fetch(`${Astro.url.origin}/api/stories`);
const stories = await res.json();
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Stories · Only Scrubs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: #f7f9fc;
        margin: 0;
      }

      header {
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        padding: 16px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      header a {
        text-decoration: none;
        color: #111827;
        font-weight: 600;
      }

      header .actions a {
        margin-left: 16px;
        text-decoration: none;
        color: #2563eb;
        font-weight: 500;
      }

      main {
        max-width: 860px;
        margin: 40px auto;
        padding: 0 16px;
      }

      .story {
        background: #ffffff;
        border-radius: 14px;
        padding: 20px;
        margin-bottom: 24px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }

      .story:hover {
        transform: translateY(-2px);
        box-shadow: 0 14px 40px rgba(0, 0, 0, 0.08);
      }

      .meta {
        font-size: 13px;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .name {
        font-weight: 600;
        color: #111827;
      }

      .time {
        margin-left: 6px;
      }

      .text {
        margin: 12px 0;
        color: #1f2937;
        white-space: pre-wrap;
      }

      .media {
        margin-top: 12px;
      }

      .media img,
      .media video {
        max-width: 100%;
        border-radius: 10px;
      }

      .media audio {
        width: 100%;
      }

      .view {
        margin-top: 12px;
        font-size: 14px;
        color: #2563eb;
        font-weight: 500;
      }

      .empty {
        text-align: center;
        color: #6b7280;
        margin-top: 80px;
      }

      @media (max-width: 600px) {
        main {
          margin-top: 24px;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <a href="/">Only Scrubs</a>
      <div class="actions">
        <a href="/create">Share your story</a>
      </div>
    </header>

    <main>
      {stories.length === 0 && (
        <div class="empty">No stories yet. Be the first to share.</div>
      )}

      {stories.map((story) => (
        <a href={`/stories/${story.id}`} style="text-decoration:none">
          <div class="story">
            <div class="meta">
              <span class="name">{story.name}</span>
              <span class="time">
                · {new Date(story.createdAt).toLocaleString()}
              </span>
            </div>

            <div class="text">
              {story.text.length > 300
                ? story.text.slice(0, 300) + "…"
                : story.text}
            </div>

            {story.mediaUrl && (
              <div class="media">
                {story.mediaType.startsWith("image") && (
                  <img src={story.mediaUrl} alt="Story media" />
                )}

                {story.mediaType.startsWith("video") && (
                  <video src={story.mediaUrl} controls />
                )}

                {story.mediaType.startsWith("audio") && (
                  <audio src={story.mediaUrl} controls />
                )}

                {!story.mediaType.startsWith("image") &&
                  !story.mediaType.startsWith("video") &&
                  !story.mediaType.startsWith("audio") && (
                    <a href={story.mediaUrl} target="_blank">
                      View attachment
                    </a>
                  )}
              </div>
            )}

            <div class="view">View story →</div>
          </div>
        </a>
      ))}
    </main>
  </body>
</html>
